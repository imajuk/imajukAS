package com.imajuk.ui.combobox{    import flash.display.InteractiveObject;
    import flash.events.MouseEvent;
    import org.libspark.thread.Thread;    /**     * @author shinyamaharu     */    public class ComboBoxItemEnableThread extends Thread     {        private var combo : ComboBox;        public function ComboBoxItemEnableThread(combo : ComboBox)        {            super();            this.combo = combo;        }                override public function toString() : String {        	return "ComboBoxItemEnableThread[" + combo.itemContainer.name + "]";        }        override protected function run() : void        {            event(combo.itemContainer, MouseEvent.CLICK, clickedHandler, false, 1);        }        private function clickedHandler(e : MouseEvent) : void         {//        	trace(this + " : clickedHandler " + ["######", combo.itemContainer]);                        next(run);             	        	//クリックされたアイテム.        	var clickedItem:IComboBoxItemView = e.target as IComboBoxItemView;        	        	if (!clickedItem)        	   return;        	        	//入れ子になったコンボボックスからのイベントは無視する            if (clickedItem is ComboBox)               return;               //        	trace("\t" + combo.itemContainer + "内の" + clickedItem + "以外のアイテムをアクティブにする");            combo.itemContainer.items.forEach(                function(item : ComboBoxItemViewContainer, idx : int, ...param):void                {                    //クリックされたアイテム                    var v : IComboBoxItemView = item.itemView;                    if (v is ComboBox)                    {                        var c : ComboBox = ComboBox(v);                         //アイテムがコンボボックスなら...                        //実際にクリックされたアイテムをこのコンボボックスがもっていなければ                        //このコンボボックスをアクティブにして閉じる//                        trace("\t\t", c + " : hasItem " + [clickedItem, c.hasItem(IComboBoxItemView(clickedItem))]);                        if (!c.hasItem(IComboBoxItemView(clickedItem)))                        {                            c.mouseChildren = true;//                            trace("\t\t", c + " : mouseEnabled " + [true], "close");                            c.close();//                            trace("\t\t", c + " : close ");                        }                        else                        {                        	c.open();                        }                    }                    else                    {                    	//コンボボックス内のアイテムは、                    	//一つのアイテムが選択されたときそのアイテムはクリックできない（押せない）.                    	//残りのアイテムはアクティブになる（押せる）                    	//ただしデフォルトアイテム（デフォルトラベル）はこのとき常に押せない.                    	                        var enabled : Boolean = !(v == clickedItem);                        //デフォルトアイテム                        if (!combo.autoClose && idx == 0)                    	   enabled = false;                    	                            InteractiveObject(v).mouseEnabled = enabled;//                		trace("\t\t", v + " : mouseEnabled " + [enabled]);                    }                }            );        }
        override protected function finalize() : void        {        }    }}