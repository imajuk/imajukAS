package com.imajuk.effect{    import com.imajuk.utils.DisplayObjectUtil;    import com.imajuk.motion.TweensyThread;    import com.imajuk.utils.StageReference;    import flash.display.DisplayObject;    import flash.display.BitmapData;    import flash.display.Bitmap;    import flash.display.Sprite;    import fl.motion.easing.Exponential;    import org.libspark.thread.Thread;    /**     * @author shinyamaharu     */    public class DarkBackGroundThread extends Thread     {        private var darkness : DisplayObject;        private var container : Sprite;        public function DarkBackGroundThread(container:Sprite)        {            super();            this.container = container;        }        public function getPostThread() : Thread        {            return new TweensyThread(darkness, 0, .5, Exponential.easeInOut, null, {alpha:0});        }        override protected function run() : void        {            beDark();        }        private function beDark() : void        {            if (isInterrupted)               return;            if (!darkness)            {                darkness =                 	new Bitmap(                		new BitmapData(                			StageReference.stage.stageWidth,                			StageReference.stage.stageHeight,                 			true,                 			0xCC000000)                		);                darkness.alpha = 0;                container.addChild(darkness);            }                        next(showDark);        }        private function showDark() : void        {            var t : Thread = new TweensyThread(darkness, 0, .5, Exponential.easeInOut, null, {alpha:1});            t.start();            t.join();                        next(idle);        }                private function idle() : void        {        	if (isInterrupted)        		return;        		            next(idle);        }        override protected function finalize() : void        {        	DisplayObjectUtil.removeChild(darkness);        	DisplayObjectUtil.removeChild(container);        }    }}