package com.imajuk.media{    import com.imajuk.utils.StageReference;    import org.libspark.thread.Thread;    import flash.display.Sprite;    import flash.events.MouseEvent;    import flash.geom.Rectangle;    /**     * @author shinyamaharu     */    public class VideoPlayHeadDraggingThread extends Thread     {        private var videoUI : IVideoUI;
        private var video : SimpleFLVPlayer;        private var head : Sprite;        private var pressedPosition : Number;
        private var area : Rectangle;
        public function VideoPlayHeadDraggingThread(video:SimpleFLVPlayer, videoUI:IVideoUI)        {            super();                        this.video = video;            this.videoUI = videoUI;            this.head = videoUI.playHead;                        area = videoUI.getDraggableArea();        }        override protected function run() : void        {        	if (isInterrupted) return;        	interrupted(function():void{});        	        	event(head, MouseEvent.MOUSE_DOWN, headDownHandler);        	event(StageReference.stage, MouseEvent.MOUSE_UP, mouseUpHandler);        }                /**         * ヘッドが押された         */        private function headDownHandler(e : MouseEvent) : void        {        	if (isInterrupted) return;        	            //=================================            // ヘッドはドラッグしてシークできる            //=================================            videoUI.isHeadDragging = true;            pressedPosition = Sprite(e.target).x;                        //ドラッグできる範囲            var l : Number = video.getBytesLoaded();            var t : Number = video.getBytesTotal();            var loadedPer:Number = l / t;            area.width *= loadedPer;            //ドラッグ開始             head.startDrag(false, area);                        run();        }                private function mouseUpHandler(e : MouseEvent) : void        {        	if (isInterrupted) return;        	            if (videoUI.isHeadDragging)            {                //ヘッドのドラッグを終了                head.stopDrag();                //シーク開始                seek();                videoUI.isHeadDragging = false;            }                        run();        }                private function seek() : void        {            video.seek(videoUI.getPlayheadPosition() * video.duration);        }        override protected function finalize() : void        {        }    }}